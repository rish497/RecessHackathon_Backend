<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Teen Finance App</title>
<style>
body { margin:0; font-family: Arial, sans-serif; display:flex; height:100vh; }
.sidebar {
  width: 80px;
  background-color: #22012c;
  color: white;
  display: flex;
  flex-direction: column;
  padding-top: 20px;
}
.sidebar button {
  position: relative;
  background: none;
  border: none;
  color: white;
  padding: 15px;
  text-align: center;
  cursor: pointer;
  font-size: 16px;
}

.sidebar button .tooltip-text {
  visibility: hidden;
  width: max-content;
  background-color: #444;
  color: #fff;
  text-align: center;
  padding: 5px 8px;
  border-radius: 5px;


  position: absolute;
  left: 100%; 
  top: 50%;
  transform: translateY(-50%);
  z-index: 1;


  opacity: 0;
  transition: opacity 0.3s;
}
.chat-message {
    margin-bottom: 10px;
    padding: 6px 10px;
    border-radius: 8px;
    max-width: 80%;
    word-wrap: break-word;
}

.chat-user {
    background-color: #e0e0e0;
    text-align: right;
    margin-left: auto;
}

.chat-bot {
    background-color: #d1ecf1;
    text-align: left;
    margin-right: auto;
}

.sidebar button:hover .tooltip-text {
  visibility: visible;
  opacity: 1;
}
.sidebar button:hover {
  background-color: #444;
}
.main {
  flex-grow:1;
  padding: 20px;
  overflow-y: auto;
}

.history-btn {
  background: #eee;
  border: none;
  padding: 6px 12px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 14px;
  margin-top: 5px;
}
.history-btn:hover {
  background: #d5b6f2;
}


#chatbot h2 {
    color: #5a2d82;          
    font-size: 24px;         
    margin-bottom: 8px;
}


#chatbot p {
    color: #7b3cb1;          
    font-size: 16px;
    margin-bottom: 15px;
}


#chatbot h2::after {
    content: "";
    display: block;
    width: 50px;
    height: 3px;
    background: #7b3cb1;
    border-radius: 2px;
    margin-top: 4px;
}


.section { display: none; }
</style>


</head>
<body>

<div class="sidebar">
    <button onclick="showSection('addCard')">
    <img src="https://cdn-icons-png.flaticon.com/512/771/771508.png" 
        alt="Card" style="width:40px; vertical-align:middle; margin-right:10px;">
     <span class="tooltip-text">Cards</span>
    </button>

  <button onclick="showSection('Budgeting')">
    <img src="https://cdn-icons-png.flaticon.com/512/15550/15550149.png" 
        alt="Card" style="width:40px; vertical-align:middle; margin-right:10px;">
    <span class="tooltip-text">Budgeting</span></button>

  <button onclick="showSection('goalsBills')">
    <img src="https://cdn-icons-png.flaticon.com/512/14699/14699785.png" 
        alt="Card" style="width:40px; vertical-align:middle; margin-right:10px;">
    <span class="tooltip-text">Financial Goals</span></button>
  <button onclick="showSection('chatbot')">
    <img src="https://cdn-icons-png.freepik.com/512/10063/10063451.png" 
        alt="Card" style="width:40px; vertical-align:middle; margin-right:10px;">
    <span class="tooltip-text">Chatbot</span></button>
  <button onclick="showSection('courses')">
    <img src="https://cdn-icons-png.freepik.com/512/14843/14843045.png" 
        alt="Card" style="width:40px; vertical-align:middle; margin-right:10px;">
    <span class="tooltip-text">Courses</span></button>
  <button onclick="showSection('badges')">
    <img src="https://cdn-icons-png.flaticon.com/512/6793/6793440.png" 
        alt="Card" style="width:40px; vertical-align:middle; margin-right:10px;">
    <span class="tooltip-text">Badges</span></button>
</div>

<div class="main">
  <div id="addCard" class="section">
    <h2>Add Card</h2>
    <p>Feature not available yet.</p>
  </div>

<!--BUDGETING PAGE START-->
<div id="Budgeting" class="section">
  <h2>Spending & Budgets</h2>
  <div class="budget-summary">
    <p><strong>Total Budgets:</strong> <span id="total-spent">$0</span> of <span id="total-budgeted">$0</span></p>
  </div>

  <div id="budget-grid" class="budget-grid"></div>

  <!-- Floating Add Button -->
  <button class="add-budget-btn" onclick="openAddBudget()">+</button>
</div>

<!-- Add Budget Modal -->
<div id="budgetModal" class="modal">
  <div class="modal-content">
    <h3 style="color:#5a2d82;">Add Budget</h3>
    <label>Category:<br>
      <input type="text" id="budgetCategory">
    </label><br><br>
    <label>Amount:<br>
      <input type="number" id="budgetAmount">
    </label><br><br>
    <button class="btn" onclick="addBudget()">Add</button>
    <button class="btn secondary" onclick="closeBudgetModal()">Cancel</button>
  </div>
</div>

<!-- Add Spending Modal -->
<div id="spendingModal" class="modal">
  <div class="modal-content">
    <h3 style="color:#5a2d82;">Add Spending</h3>
    <p id="spendCategoryTitle"></p>
    <label>Amount:<br>
      <input type="number" id="spendingAmount">
    </label><br><br>
    <button class="btn" onclick="addSpending()">Add</button>
    <button class="btn secondary" onclick="closeSpendingModal()">Cancel</button>
  </div>
</div>

<style>
  #Budgeting h2 {
    color: #5a2d82;
    margin-bottom: 15px;
  }

  .budget-summary {
    margin-bottom: 20px;
    font-size: 1.1rem;
    font-weight: bold;
    color: #5a2d82;
  }

  .budget-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
    gap: 15px;
  }

  .budget-card {
    background: #f3e9f7;
    border-radius: 15px;
    padding: 15px;
    box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    position: relative;
    transition: transform 0.2s;
  }
  .budget-card:hover {
    transform: scale(1.02);
  }

  .budget-card.overspent {
    border-left: 4px solid red;
  }

  .budget-title {
    font-size: 1.1rem;
    font-weight: bold;
    color: #5a2d82;
  }

  .budget-amount {
    color: #7b3cb1;
    margin: 5px 0;
  }

  .budget-left {
    font-size: 0.9rem;
    color: #666;
  }

  .card-add-btn {
    position: absolute;
    top: 10px;
    right: 10px;
    background: #7b3cb1;
    color: #fff;
    border: none;
    border-radius: 50%;
    width: 28px;
    height: 28px;
    font-size: 1rem;
    cursor: pointer;
  }

  .card-add-btn:hover {
    background: #5a2d82;
  }

  .add-budget-btn {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: #7b3cb1;
    color: #fff;
    font-size: 2rem;
    border: none;
    border-radius: 50%;
    width: 55px;
    height: 55px;
    cursor: pointer;
    box-shadow: 0 3px 10px rgba(0,0,0,0.2);
    z-index: 1000;
  }

  .add-budget-btn:hover {
    background: #5a2d82;
  }

  /* Modal styling */
  .modal {
    display: none;
    position: fixed;
    z-index: 100;
    left: 0; top: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.4);
    justify-content: center;
    align-items: center;
  }

  .modal-content {
    background: #fff;
    padding: 20px;
    border-radius: 12px;
    width: 300px;
    text-align: center;
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
  }

  .modal-content input {
    width: 90%;
    padding: 8px;
    margin: 6px 0;
    border-radius: 8px;
    border: 1px solid #ccc;
  }

  .budget-card {
  background: #fff;
  border-radius: 16px;
  padding: 16px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.08);
  display: flex;
  flex-direction: column;
  gap: 12px;
  transition: transform 0.15s ease, box-shadow 0.15s ease;
}

.budget-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(0,0,0,0.12);
}

.budget-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.budget-progress {
  background: #eee;
  border-radius: 10px;
  height: 8px;
  overflow: hidden;
}

.progress-bar {
  background: linear-gradient(90deg, #7b3cb1, #5a2d82);
  height: 100%;
  transition: width 0.3s ease;
}

.budget-details {
  font-size: 0.95rem;
  color: #444;
}

.budget-left {
  font-size: 0.85rem;
  color: #777;
}

</style>

<script>
  let budgets = [];
  let activeCategory = null;

  // === Budget Modal ===
  function openAddBudget() {
    document.getElementById("budgetModal").style.display = "flex";
  }

  function closeBudgetModal() {
    document.getElementById("budgetModal").style.display = "none";
    document.getElementById("budgetCategory").value = "";
    document.getElementById("budgetAmount").value = "";
  }

  function addBudget() {
    const category = document.getElementById("budgetCategory").value.trim();
    const amount = parseFloat(document.getElementById("budgetAmount").value);

    if (!category || isNaN(amount) || amount <= 0) return;

    budgets.push({ category, budget: amount, spent: 0 });

    renderBudgets();
    closeBudgetModal();
  }

  // === Spending Modal ===
  function openSpendingModal(index) {
    activeCategory = index;
    document.getElementById("spendCategoryTitle").textContent = "Category: " + budgets[index].category;
    document.getElementById("spendingModal").style.display = "flex";
  }

  function closeSpendingModal() {
    document.getElementById("spendingModal").style.display = "none";
    document.getElementById("spendingAmount").value = "";
  }

  function addSpending() {
    const amount = parseFloat(document.getElementById("spendingAmount").value);
    if (!amount || activeCategory === null) return;

    budgets[activeCategory].spent += amount;

    renderBudgets();
    closeSpendingModal();
  }

  // === Render UI ===
  function renderBudgets() {
    const grid = document.getElementById("budget-grid");
    grid.innerHTML = "";

    let totalBudgeted = 0;
    let totalSpent = 0;

    budgets.forEach((b, index) => {
      totalBudgeted += b.budget;
      totalSpent += b.spent;

      const left = b.budget - b.spent;
      const overspent = left < 0;

      const card = document.createElement("div");
      card.className = "budget-card " + (overspent ? "overspent" : "");
      card.innerHTML = `
        <div class="budget-header">
            <span class="budget-title">${b.category}</span>
            <button class="card-add-btn" onclick="openSpendingModal(${index})">+</button>
        </div>
        <div class="budget-progress">
            <div class="progress-bar" style="width: ${(b.spent / b.budget) * 100}%"></div>
        </div>
        <div class="budget-details">
            <span class="spent">$${b.spent}</span> of <span class="total">$${b.budget}</span>
        </div>
        <div class="budget-left">
            ${overspent ? "Overspent $" + Math.abs(left) : "$" + left + " left"}
        </div>
    `;

      grid.appendChild(card);
    });

    document.getElementById("total-budgeted").textContent = '$'+totalBudgeted;
    document.getElementById("total-spent").textContent = '$'+totalSpent;
  }
</script>

<!--BUDGETING PAGE END-->


  <!---GOAL AND BILL PAGE START-->
  <div id="goalsBills" class="section">
    <h2>🏆 Financial Goals </h2>

    <!-- Buttons -->
    <button class="btn" onclick="openGoalModal()">+ Enter Goal</button>
    <button id="updateBtn" class="btn secondary" onclick="openUpdateModal()" style="display:none;">✏️ Update Goal</button>

    <!-- Goal List -->
    <div id="goalList"></div>

    <!-- Enter Goal Modal -->
    <div id="goalModal" class="modal">
        <div class="modal-content">
        <span class="close" onclick="closeModal('goalModal')">&times;</span>
        <h3>🎯 Enter a New Goal</h3>
        <input type="text" id="goalName" placeholder="Goal name">
        <input type="number" id="goalTarget" placeholder="Target amount">
        <button class="btn" onclick="addGoal()">Save Goal</button>
        </div>
    </div>

    <!-- Update Goal Modal -->
    <div id="updateModal" class="modal">
        <div class="modal-content">
        <span class="close" onclick="closeModal('updateModal')">&times;</span>
        <h3>💰 Update Goal</h3>
        <select id="goalSelect"></select>
        <input type="number" id="goalSaved" placeholder="Amount saved">
        <textarea id="goalNote" placeholder="How was this done..." rows="2" style="width: 90%; margin: 8px 0; border-radius: 8px; padding: 8px;"></textarea>
        <button class="btn secondary" onclick="updateGoal()">Update</button>

        </div>
    </div>
    </div>

    <style>

    #goalsBills {
    background: #f3e9f7; 
    padding: 20px;
    border-radius: 15px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    #goalsBills h2 {
    color: #5a2d82;
    margin-bottom: 15px;
    }

    /* Buttons */
    .btn {
    background: #7b3cb1;
    color: white;
    border: none;
    padding: 10px 16px;
    border-radius: 8px;
    cursor: pointer;
    margin: 5px;
    font-size: 14px;
    transition: background 0.3s;
    }
    .btn:hover {
    background: #9c55d4;
    }
    .btn.secondary {
    background: #5a2d82;
    }
    .btn.secondary:hover {
    background: #7b3cb1;
    }

    /* Modal styles */
    .modal {
    display: none; 
    position: fixed; 
    z-index: 10; 
    left: 0; top: 0; 
    width: 100%; height: 100%; 
    background-color: rgba(0,0,0,0.5);
    }
    .modal-content {
    background: #fff;
    margin: 10% auto;
    padding: 20px;
    width: 320px;
    border-radius: 12px;
    text-align: center;
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
    .modal-content h3 {
    margin-bottom: 15px;
    color: #5a2d82;
    }
    .modal-content input, .modal-content select {
    width: 90%;
    padding: 10px;
    margin: 8px 0;
    border: 1px solid #ccc;
    border-radius: 8px;
    }
    .close {
    float: right;
    font-size: 20px;
    cursor: pointer;
    color: #5a2d82;
    }

    /* Progress bar */
.progress-bar {
  height: 22px;
  width: 0%; 
  background: linear-gradient(90deg, #7b3cb1, #9c55d4); 
  text-align: center;
  color: white;
  font-size: 12px;
  line-height: 22px;
  border-radius: 10px;
  transition: width 0.4s ease;
}
    </style>

    <script>
    let goals = {};

    function openGoalModal(){
    document.getElementById("goalModal").style.display="block";
    }
    function openUpdateModal(){
    document.getElementById("updateModal").style.display="block";
    let select = document.getElementById("goalSelect");
    select.innerHTML = "";
    for(let g in goals){
        let opt = document.createElement("option");
        opt.value = g;
        opt.textContent = g;
        select.appendChild(opt);
    }
    }
    function closeModal(id){
    document.getElementById(id).style.display="none";
    }

    // Add new goal
    function addGoal() {
        let name = document.getElementById("goalName").value;
        let target = parseFloat(document.getElementById("goalTarget").value);
        if (!name || !target) return alert("Fill both fields!");

        goals[name] = { target: target, saved: 0, history: [] };

        let list = document.getElementById("goalList");
        let div = document.createElement("div");
        div.id = "goal-" + name;
        div.style.marginTop = "20px"; 
        div.innerHTML = `
            <h4>${name} ($0 / $${target})</h4>
            <div class="progress-bar" id="bar-${name}" style="width:1%;">0%</div>
            <button class="history-btn" onclick="showHistory('${name}')">View History</button>
        `;
        list.appendChild(div);

        document.getElementById("updateBtn").style.display = "inline-block"; 
        closeModal("goalModal");

        let safeName = name.replace(/\s/g, "_");
            div.id = "goal-" + safeName;
            div.innerHTML = `
                <h4>${name} ($0 / $${target})</h4>
                <div class="progress-bar" id="bar-${safeName}" style="width:1%;">0%</div>
                <button class="history-btn" onclick="showHistory('${name}')">View History</button>
            `;
    }

    
    //History Button
    function showHistory(name){
        let history = goals[name].history;
        let modal = document.createElement("div");
        modal.className = "modal";
        modal.innerHTML = `
            <div class="modal-content">
                <span class="close" onclick="this.parentElement.parentElement.remove()">&times;</span>
                <h3>History for ${name}</h3>
                <ul>
                    ${history.map(h => `<li>$${h.amount} - ${h.note} (${h.date})</li>`).join("<br><br>")}
                </ul>

            </div>
        `;
        document.body.appendChild(modal);
        modal.style.display = "block";
    }

    
    // Update goal progress
    function updateGoal(){
        let name = document.getElementById("goalSelect").value;
        let amount = parseFloat(document.getElementById("goalSaved").value);
        let note = document.getElementById("goalNote").value || "";

        if (isNaN(amount)) return alert("Enter a valid amount!");

        // Add to saved
        goals[name].saved += amount;

        // ADD HISTORY ENTRY
        goals[name].history.push({
            amount: amount,
            note: note,
            date: new Date().toLocaleDateString()
        });

        let percent = Math.min((goals[name].saved / goals[name].target) * 100, 100).toFixed(1);

        const safeName = name.replace(/\s/g, "_");
        const goalDiv = document.getElementById("goal-" + safeName);
        if(!goalDiv) return alert("Goal not found!");

        goalDiv.querySelector("h4").innerText = `${name} ($${goals[name].saved} / $${goals[name].target})`;
        const bar = document.getElementById("bar-" + safeName);
        if(bar) {
            bar.style.width = percent + "%";
            bar.innerText = percent + "%";
        }

        closeModal("updateModal");
        checkAllBadges();
    }



    </script>
<!---GOAL AND BILL PAGE END-->

<!--GEMINI CHATBOT START-->
<div id="chatbot" class="section">
    <h2>Chatbot 🤖</h2>
    <p>Talk to the bot for advice or search for better plans.</p>

    <!-- Chat box -->
    <div id="chatbox" class="chatbox"></div>

    <!-- Input area -->
    <div class="chat-input">
        <input type="text" id="userInput" placeholder="Type your message..." />
        <button class="btn" onclick="sendMessage()">Send</button>
    </div>
</div>

<!-- Include marked.js for Markdown support -->
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

<style>
/* Chatbox styling */
.chatbox {
    width: 100%;
    height: 400px;
    border: 1px solid #ccc;
    border-radius: 12px;
    background: #f3e9f7;  
    overflow-y: auto;
    padding: 10px;
    margin-top: 10px;
    box-shadow: 0 3px 8px rgba(0,0,0,0.08);
}

/* Chat input styling */
.chat-input {
    margin-top: 10px;
    display: flex;
    gap: 10px;
}

.chat-input input {
    flex: 1;
    padding: 10px;
    border-radius: 8px;
    border: 1px solid #ccc;
    font-size: 14px;
}

.chat-input button {
    background: #7b3cb1; 
    color: white;
    border: none;
    border-radius: 8px;
    padding: 10px 16px;
    cursor: pointer;
    font-size: 14px;
    transition: background 0.3s;
}

.chat-input button:hover {
    background: #9c55d4;
}

/* Chat messages */
.chatbox div {
    margin-bottom: 8px;
    padding: 6px 10px;
    border-radius: 8px;
    word-wrap: break-word;
}

/* Bot messages */
.bot-msg {
    background: #e6d6f0; 
    text-align: left;
}

/* User messages */
.user-msg {
    background: #d1c1e8; 
    text-align: right;
}


.bot-msg b, .bot-msg strong {
    color: #5a2d82; 
}

/* Lists in bot messages */
.bot-msg ul {
    padding-left: 20px;
    margin: 5px 0;
}
.bot-msg li {
    margin-bottom: 4px;
}
</style>

<script>
async function sendMessage() {
    const input = document.getElementById("userInput");
    const message = input.value.trim();
    if (!message) return;

    const chatbox = document.getElementById("chatbox");
    chatbox.innerHTML += `<div class="user-msg"><b>You:</b> ${message}</div>`;
    input.value = "";

    try {
        const response = await fetch("/chat", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ message })
        });
        const data = await response.json();

        const html = marked.parse(data.response);
        chatbox.innerHTML += `<div class="bot-msg"><b>Bot:</b> ${html}</div>`;
    } catch (err) {
        chatbox.innerHTML += `<div class="bot-msg"><b>Bot:</b> Sorry, something went wrong.</div>`;
    }

    chatbox.scrollTop = chatbox.scrollHeight;
}
</script>


<!--GEMINI CHATBOT END-->

<!--COURSES SECTION START-->

<div id="courses" class="section">
  <h2>Money Courses 💰</h2>
  <p>Search for financial courses and videos to boost your money skills.</p>

  <!-- Search bar -->
  <div id="yt-search-bar" style="margin-top:10px; display:flex; gap:10px;">
    <input type="text" id="ytQuery" placeholder="Search financial courses..." style="flex:1; padding:10px; border-radius:8px; border:1px solid #ccc;" />
    <button class="btn" onclick="searchYouTube()">Search</button>
  </div>

  <!-- YouTube results -->
  <div id="ytResults" style="margin-top:15px; display:grid; grid-template-columns:repeat(auto-fill,minmax(250px,1fr)); gap:15px;"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script>
const API_KEY = 'API_KEY_YOUTUBE' ;

async function searchYouTube() {
  const query = document.getElementById("ytQuery").value.trim();
  if (!query) return alert("Type a search term!");

  const response = await fetch(`https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&maxResults=8&q=${encodeURIComponent(query)}&key=${API_KEY}`);
  const data = await response.json();

  const resultsDiv = document.getElementById("ytResults");
  resultsDiv.innerHTML = "";

  data.items.forEach(item => {
    const videoId = item.id.videoId;
    const title = item.snippet.title;
    const thumb = item.snippet.thumbnails.medium.url;

    const card = document.createElement("div");
    card.classList.add("yt-card");
    card.innerHTML = `
      <a href="https://www.youtube.com/watch?v=${videoId}" target="_blank">
        <img src="${thumb}" alt="${title}" />
        <p>${title}</p>
      </a>
    `;
    resultsDiv.appendChild(card);
  });
}
</script>

<style>
/* Section heading & description */
#courses h2 {
  color: #5a2d82;
  font-size: 24px;
  margin-bottom: 8px;
}
#courses p {
  color: #7b3cb1;
  font-size: 16px;
  margin-bottom: 15px;
}

/* YouTube result cards */
.yt-card {
  background: #f3e9f7; 
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 3px 8px rgba(0,0,0,0.08);
  cursor: pointer;
  transition: transform 0.2s;
}
.yt-card:hover {
  transform: scale(1.03);
}
.yt-card img {
  width: 100%;
  display: block;
}
.yt-card p {
  padding: 8px;
  margin: 0;
  font-size: 14px;
  color: #5a2d82;
}
</style>
<!--COURSES SECTION END-->

<!--BADGES PAGE START-->
<div id="badges" class="section">
  <h2>Badges 🏆</h2>
  <p>Complete tasks to earn badges! Your earned badges will pop up as notifications.</p>

  <!-- Badge display area -->
  <div id="badgeList" style="display:flex; gap:15px; margin-top:15px;"></div>
</div>

<!-- Notification container -->
<div id="badgeNotification" style="
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: #f3e9f7;
    border: 1px solid #5a2d82;
    padding: 10px 15px;
    border-radius: 12px;
    box-shadow: 0 3px 8px rgba(0,0,0,0.2);
    display: none;
    align-items: center;
    gap:10px;
    z-index: 9999;
">
  <img id="notifBadgeImg" src="" style="width:40px; height:40px; border-radius:8px;" />
  <span id="notifText" style="color:#5a2d82; font-weight:bold;">You earned a badge!</span>
</div>

<script>
/********** BADGE SETUP **********/
const badges = [
  {id: 'save100', name: '💰 Save $100', img: 'https://cdn-icons-png.flaticon.com/512/190/190411.png', earned: false},
  {id: 'login5', name: '🗓️ 5-Day Streak', img: 'https://cdn-icons-png.flaticon.com/512/929/929417.png', earned: false},
  {id: 'subscriber1yr', name: '🎖️ 1-Year Subscriber', img: 'https://cdn-icons-png.flaticon.com/512/616/616408.png', earned: false}
];

const badgeList = document.getElementById('badgeList');

function renderBadges() {
  badgeList.innerHTML = "";
  badges.forEach(b => {
    const div = document.createElement('div');
    div.id = 'badge-' + b.id;
    div.style.cssText = `
      position: relative;
      background: #f3e9f7;
      border-radius: 12px;
      padding: 10px;
      text-align: center;
      width: 120px;
      box-shadow: 0 3px 8px rgba(0,0,0,0.08);
      opacity: ${b.earned ? '1' : '0.4'};
      border: ${b.earned ? '2px solid #5a2d82' : '2px solid #ccc'};
    `;

    div.innerHTML = `
      <img src="${b.img}" style="width:50px; height:50px; ${b.earned ? '' : 'filter: grayscale(100%)'}" />
      <p style="color:#5a2d82; font-size:14px; margin-top:5px;">${b.name}</p>
      ${b.earned ? '' : '<div style="position:absolute; top:0; right:0; font-size:16px; color:#888;">🔒</div>'}
    `;
    badgeList.appendChild(div);
  });
}

/********** NOTIFICATION FUNCTION **********/
function earnBadge(id) {
  const badge = badges.find(b => b.id === id);
  if (!badge || badge.earned) return;
  badge.earned = true;

  renderBadges(); 

  // Show notification
  const notif = document.getElementById('badgeNotification');
  document.getElementById('notifBadgeImg').src = badge.img;
  document.getElementById('notifText').innerText = `You earned this badge! ${badge.name}`;
  notif.style.display = 'flex';
  setTimeout(() => { notif.style.display = 'none'; }, 3000);
}

/********** $100 SAVED BADGE **********/
function totalSaved() {
  let sum = 0;
  if (typeof goals === 'object') {
    for (let g in goals) sum += goals[g].saved || 0;
  }
  return sum;
}

/********** 5-DAY LOGIN STREAK BADGE **********/
function updateLoginStreak() {
  let lastLogin = localStorage.getItem('lastLogin') || null;
  let streak = parseInt(localStorage.getItem('loginStreak') || '0');
  const today = new Date().toDateString();

  if (lastLogin === today) return;

  if (lastLogin) {
    const yesterday = new Date();
    yesterday.setDate(yesterday.getDate() - 1);
    if (new Date(lastLogin).toDateString() === yesterday.toDateString()) streak += 1;
    else streak = 1;
  } else streak = 1;

  localStorage.setItem('lastLogin', today);
  localStorage.setItem('loginStreak', streak);

  if (streak >= 5) earnBadge('login5');
}

/********** 1-YEAR SUBSCRIBER BADGE **********/
function checkSubscription() {
  const subscribeDate = localStorage.getItem('subscribedOn');
  if (!subscribeDate) return;
  const subDate = new Date(subscribeDate);
  const now = new Date();
  const days = (now - subDate) / (1000 * 60 * 60 * 24);
  if (days >= 365) earnBadge('subscriber1yr');
}

/********** CHECK ALL BADGES **********/
function checkAllBadges() {
  if (totalSaved() >= 100) earnBadge('save100');
  updateLoginStreak();
  checkSubscription();
}

// Initial render
renderBadges();
checkAllBadges();
</script>


<!--BADGES PAGE END-->
<script>
function showSection(id){
  document.querySelectorAll('.section').forEach(s => s.style.display='none');
  document.getElementById(id).style.display='block';
}


showSection('goalsBills');
</script>

</body>
</html>
